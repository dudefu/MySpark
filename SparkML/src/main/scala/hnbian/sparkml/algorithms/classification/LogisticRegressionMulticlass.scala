package hnbian.lr

import hnbian.spark.utils.SparkUtils
import org.apache.spark.ml.classification.LogisticRegression
import org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator
import utils.FileUtils

/**
  * @author hnbian
  *         @ Description 多项式逻辑回归
  *         @ Date 2019/1/3 17:53
  **/
object LogisticRegressionMulticlass extends App {
  val spark = SparkUtils.getSparkSession("LogisticRegressionMulticlass",4)
  val  filePath = FileUtils.getFilePath("sample_multiclass_classification_data.txt")

  val training = spark
    .read
    .format("libsvm")
    .load(filePath)

  val lr = new LogisticRegression()
    .setMaxIter(10)
    .setRegParam(0.3)
    .setElasticNetParam(0.8)

  val lrModel = lr.fit(training)

  // Print the coefficients and intercept for multinomial logistic regression
  println(s"Coefficients: \n${lrModel.coefficientMatrix}")
  /**
    * Coefficients:
    * 3 x 4 CSCMatrix
    * (1,2) -0.7803943459681859
    * (0,3) 0.3176483191238039
    * (1,3) -0.3769611423403096
    */
  println(s"Intercepts: ${lrModel.interceptVector}")
  //Intercepts: [0.05165231659832854,-0.12391224990853622,0.07225993331020768]
  //通过模型预测结果
  val predictions = lrModel.transform(training)

  predictions.show(false)
  predictions.select("label","prediction","probability","rawPrediction","features").show(false)
  /**
    * +-----+----------+------------------------------------------------------------+-----------------------------------------------------------------+-----------------------------------------------------------+
    * |label|prediction|probability                                                 |rawPrediction                                                    |features                                                   |
    * +-----+----------+------------------------------------------------------------+-----------------------------------------------------------------+-----------------------------------------------------------+
    * |1.0  |1.0       |[0.19824091021950388,0.5380629504663061,0.26369613931419]   |[-0.21305451012206839,0.7854380421234279,0.07225993331020768]    |(4,[0,1,2,3],[-0.222222,0.5,-0.762712,-0.833333])          |
    * |1.0  |1.0       |[0.18250386256254247,0.568221142106847,0.24927499533061048] |[-0.23952541514793146,0.8962139249724502,0.07225993331020768]    |(4,[0,1,2,3],[-0.555556,0.25,-0.864407,-0.916667])         |
    * |1.0  |1.0       |[0.18980556250236028,0.5577188309398853,0.25247560655775453]|[-0.21305451012206839,0.8648002451366628,0.07225993331020768]    |(4,[0,1,2,3],[-0.722222,-0.166667,-0.864407,-0.833333])    |
    * |1.0  |1.0       |[0.19632523546632502,0.5355216883905428,0.2681530761431321] |[-0.23952541514793146,0.7639433264856103,0.07225993331020768]    |(4,[0,1,2,3],[-0.722222,0.166667,-0.694915,-0.916667])     |
    * |0.0  |0.0       |[0.4375039818343829,0.18146938948218602,0.38102662868343107]|[0.21047647616023052,-0.6695223444410741,0.07225993331020768]    |(4,[0,1,2,3],[0.166667,-0.416667,0.457627,0.5])            |
    * |1.0  |1.0       |[0.18250386256254247,0.568221142106847,0.24927499533061048] |[-0.23952541514793146,0.8962139249724502,0.07225993331020768]    |(4,[0,2,3],[-0.833333,-0.864407,-0.916667])                |
    * |2.0  |0.0 *     |[0.37581775428218006,0.2505614888540287,0.37362075686379126]|[0.07812299927036823,-0.32727697566780806,0.07225993331020768]   |(4,[0,1,2,3],[-1.32455E-7,-0.166667,0.220339,0.0833333])   |
    * |2.0  |2.0       |[0.3510273915379525,0.2906363236580725,0.3583362848039749]  |[0.05165230377890003,-0.1371392165046517,0.07225993331020768]    |(4,[0,1,2,3],[-1.32455E-7,-0.333333,0.0169491,-4.03573E-8])|
    * |1.0  |1.0       |[0.17808226409449213,0.5721574660564578,0.24976026984905003]|[-0.2659960025254754,0.9011726399131196,0.07225993331020768]     |(4,[0,1,2,3],[-0.5,0.75,-0.830508,-1.0])                   |
    * |0.0  |0.0       |[0.44258017540583633,0.16163302558940845,0.3957867990047552]|[0.18400588878268653,-0.8232872551325279,0.07225993331020768]    |(4,[0,2,3],[0.611111,0.694915,0.416667])                   |
    * |0.0  |0.0       |[0.4444230148660403,0.17863559375693347,0.37694139137702626]|[0.23694706353777445,-0.6744818397760896,0.07225993331020768]    |(4,[0,1,2,3],[0.222222,-0.166667,0.423729,0.583333])       |
    * |1.0  |1.0       |[0.1753920693035666,0.5786206574472668,0.24598727324916655] |[-0.2659960025254754,0.9276272278470951,0.07225993331020768]     |(4,[0,1,2,3],[-0.722222,-0.166667,-0.864407,-1.0])         |
    * |1.0  |1.0       |[0.18250386256254247,0.568221142106847,0.24927499533061048] |[-0.23952541514793146,0.8962139249724502,0.07225993331020768]    |(4,[0,1,2,3],[-0.5,0.166667,-0.864407,-0.916667])          |
    * |2.0  |2.0       |[0.3537112464509239,0.2852127321272451,0.36107602142183104] |[0.05165230377890003,-0.16359325816258505,0.07225993331020768]   |(4,[0,1,2,3],[-0.222222,-0.333333,0.0508474,-4.03573E-8])  |
    * |2.0  |2.0       |[0.32360705108265925,0.31874480283179474,0.3576481460855459]|[-0.027759763182622438,-0.0428989461327082,0.07225993331020768]  |(4,[0,1,2,3],[-0.0555556,-0.833333,0.0169491,-0.25])       |
    * |2.0  |2.0       |[0.33909561029444296,0.30546298762039154,0.3554414020851655]|[0.025181633926288853,-0.07927185213629911,0.07225993331020768]  |(4,[0,1,2,3],[-0.166667,-0.416667,-0.0169491,-0.0833333])  |
    * |1.0  |1.0       |[0.17976563656243563,0.5746994055166108,0.24553495792095353]|[-0.23952541514793146,0.9226677325120797,0.07225993331020768]    |(4,[0,2,3],[-0.944444,-0.898305,-0.916667])                |
    * |2.0  |2.0       |[0.3299437131426226,0.3149308100595172,0.35512547679786005] |[-0.0012891758050784866,-0.04785828538885445,0.07225993331020768]|(4,[0,1,2,3],[-0.277778,-0.583333,-0.0169491,-0.166667])   |
    * |0.0  |0.0       |[0.39691355784123494,0.21880137373710423,0.3842850684216609]|[0.10459380900173557,-0.4909603605077465,0.07225993331020768]    |(4,[0,1,2,3],[0.111111,-0.333333,0.38983,0.166667])        |
    * |2.0  |2.0       |[0.3471868571075156,0.28889046288880366,0.36392268000368067]|[0.025181633926288853,-0.1586338990706646,0.07225993331020768]   |(4,[0,1,2,3],[-0.222222,-0.166667,0.0847457,-0.0833333])   |
    * +-----+----------+------------------------------------------------------------+-----------------------------------------------------------------+-----------------------------------------------------------+
    */

  //模型评估

  val evaluator = new MulticlassClassificationEvaluator()
    .setLabelCol("label")
    .setPredictionCol("prediction")
    .setMetricName("accuracy")
  //计算错误率
  val accuracy = evaluator.evaluate(predictions)
  //打印准确率
  println(s"准确率：${accuracy}")
  //准确率：0.82
  //打印错误率
  println("Test Error = " + (1.0 - accuracy))
  //Test Error = 0.18000000000000005

  spark.stop()

}
